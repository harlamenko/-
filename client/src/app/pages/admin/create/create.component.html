<nav class="navigation">
  <a (click)="back()" class="navigation__link">
    <img class="navigation__link__arrow" src="../../../assets/icons/triangle.png" alt="<">
    Назад
  </a>
</nav>

<section class="main-section" *ngIf="webStorageService.isAdmin">
  <main class="main-section__current-product">
    <figure class="main-section__current-product__card">
      <div class="admin-btns">
        <canvas #canvasForPhoto class="canvasForPhoto"
        [ngClass]="{'hide': !variantAdded}"></canvas>
        <button class="admin-btns__add" *ngIf="!variantAdded">
          <input type="file" accept="image/*" (change)="addPhotoVariant($event)" id="addFileBtn">
        </button>
        <button class="admin-btns__done" *ngIf="variantAdded" (click)="endAddVariant()"></button>
        <button class="admin-btns__del" *ngIf="!variantAdded && mainProduct.variants.length > 1" (click)="baseService.popup.open('Вы точно хотите удалить?','delProduct', this)"></button>
        <button class="btn-arrow admin-btns__left" *ngIf="mainProduct.variants.length > 1" (click)="slidePhoto('left')"></button>
        <button class="btn-arrow admin-btns__right" *ngIf="mainProduct.variants.length > 1" (click)="slidePhoto('right')"></button>
      </div>
      <img class="main-section__current-product__card__photo" 
          [src]="mainProduct.variants.length ? mainProduct.variants[currentVariant].photo : ''" 
          [alt]="mainProduct.rus_name">
      <figcaption  class="main-section__current-product__card__info">
          <textarea placeholder="Название" [(ngModel)]="mainProduct.rus_name" (keydown)="keydownNamePriceCtrls($event)" class="main-section__current-product__card__info__name name-price-controls">{{mainProduct.rus_name}}</textarea>
          <input placeholder="Краткое описание" type="text" [(ngModel)]="mainProduct.title" (keydown)="keydownNamePriceCtrls($event)" class="main-section__current-product__card__info__title name-price-controls" [value]="mainProduct.title">
          <input placeholder="Цена" type="number" min="0" [(ngModel)]="mainProduct.price" (keydown)="keydownNamePriceCtrls($event)" class="main-section__current-product__card__info__price name-price-controls" [value]="mainProduct.price">
      </figcaption>
    </figure>
    <section class="main-section__current-product__description description"  *ngIf="mainProduct.variants.length">
      <li class='description__category'>Цвет:
        <ul class='description__category__sub'>
          <li *ngFor="let color of allColors; index as i"
            class='description__category description__category--inline color-rect' 
            [ngClass]="{'current-color': i === currentVariant, 'admin-btns__add-color': color === 'none'}"
            (click)="currentVariant = !variantAdded ? i : currentVariant; !variantAdded ? chooseSizeId(0, true) : ''"
            [style.background-color]="color">
          </li>
        </ul>
      </li>
      <li class='description__category'>Размер:
        <ul class='description__category__sub'>
          <li *ngFor="let size of allSizes; index as i"
          class='description__category description__category--inline size'
          [ngClass]="{
            'choosedSize': i === choosedSizeId, 
            'existed-size': isExistedSize(i)
          }"
          (click)="toggleSize(size, i)">{{size}}</li>
        </ul>
      </li>
      <li class='description__category'>Описание:
        <div class="description-controls__wrapper">
            <ul class='description__category__sub'>
                <li class='description__category'>
                    <input autofocus id="newLineInput" (keydown)="keydownDescrInput($event)" (blur)="addNewDescrLine($event)" class="description-controls">
                </li>
                <li class='description__category' *ngFor="let line of mainProduct.descr; index as i">
                  <input [value]="line" (keydown)="keydownDescrInput($event)" (blur)="blurDescrInput(i, $event)" class="description-controls">
                </li>
            </ul>
        </div>
      </li>
      <section class="main-section__current-product__category-sex-controls">
        <select (change)="handleSelection($event, 'type')" class="main-section__current-product__category-sex-controls__control">
          <option [value]="type.name" [attr.selected]="mainProduct.type === type.name ? true : null" *ngFor="let type of sexesTypes?.types">{{ type.rus_name }}</option>
        </select>
        
        <select (change)="handleSelection($event, 'sex')" class="main-section__current-product__category-sex-controls__control">
          <option [value]="sex.name" [attr.selected]="mainProduct.sex === sex.name ? true : null" *ngFor="let sex of sexesTypes?.sex">{{ sex.rus_name }}</option>
        </select>
      </section>
      <a class="btn gradient-border in btn--admin" (click)='addProduct()'>Сохранить</a>
      <a class="btn gradient-border in btn--admin" (click)='clearProduct()'>Очистить</a>
    </section>
  </main>
</section>